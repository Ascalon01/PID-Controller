# **PID Controller** 

## What is PID Controller?

A proportional–integral–derivative controller (PID controller) is a control loop mechanism employing feedback.
A PID controller continuously calculates an error value e(t) as the difference between a 
desired setpoint (SP) and a measured process variable (PV) and applies a correction based on proportional, integral,
and derivative terms (denoted P, I, and D respectively).

In this project, We use a Proportional-Integral-Derivative Controller(PID) in order to drive a simulated car around 
a track. The project involves implementing the PID controller primarily to estimate steering angle of the car.

A [video](./output_videos/output_PID.mkv) output based on driving the vehicle around track using PID Controller.

## Effects of P, I & D components in PID Controller?

* **P Component :**

Term P is proportional to the current value of the SP − PV error e(t). 
For example, if the error is large and positive, the control output will be proportionately large and positive, 
taking into account the gain factor "Kp". Using proportional control alone will result in an error between the setpoint and 
the actual process value, because it requires an error to generate the proportional response. If there is no error, 
there is no corrective response.

In our case, CTE(e(t)) is essentially how far from the middle line of the road the car is. If the car is to 
the left of the line then you would want to steer to the right; if it is far to the left of the middle with a high CTE then 
you want a higher steering angle. However, if the coefficient is set too high for P, the car will oscillate a ton, as the 
car will constantly overcorrect and overshoot the middle. 

A [video](./output_videos/output_P.mkv) output based on driving the vehicle around track using P Component alone.

* **I Component :**

Term I accounts for past values of the SP − PV error and integrates them over time to produce the I term. 
For example, if there is a residual SP − PV error after the application of proportional control, the integral 
term seeks to eliminate the residual error by adding a control effect due to the historic cumulative value of the error.
When the error is eliminated, the integral term will cease to grow. This will result in the proportional effect diminishing 
as the error decreases, but this is compensated for by the growing integral effect.

In our case, integral sums up all CTEs up to that point, such that too many negative CTEs will drive up this value, 
causing the car to turn back toward the middle, preventing the car from driving on one side of the lane the whole time. 
If the coefficient is too high for I, the car tends to have quicker oscillations, and does not tend to get up to a quick speed.
A low coefficent for I will cause the car to tend to drift to one side of the lane or the other for longer periods of time.

A [video](./output_videos/output_I.mkv) output based on driving the vehicle around track using I component alone.

* **D Component :**

Term D is a best estimate of the future trend of the SP − PV error, based on its current rate of change. 
It is sometimes called "anticipatory control", as it is effectively seeking to reduce the effect of the SP − PV error 
by exerting a control influence generated by the rate of error change. The more rapid the change, the greater the controlling 
or dampening effect

In our case, the change in CTE from one value to the next. If the derivative is quickly changing, the car will correct itself 
faster, such as in the case of a curve.  if the car is moving outward from the middle, this will cause the steering to get larger 
but if the car is moving toward the center , the car's steering angle will get smoothed out, leading to a more smoother driving experience.
Too high of a coefficient leads to almost constant steering angle changes of large degrees, where although the car will be well-centered it can hardly move. 
Too low of a D coefficient will lead to the oscillations being too high with more overshooting.

A [video](./output_videos/output_D.mkv) output based on driving the vehicle around track using D component alone.

## Tuning 

The balance of these effects is achieved by loop tuning to produce the optimal control function. 
The tuning constants are shown below as "K" and must be derived for each control application, as they depend on the 
response characteristics of the complete loop external to the controller. These are dependent on the behaviour of the 
measuring sensor, the final control element (such as a control valve), any control signal delays and the process itself.
Approximate values of constants can usually be initially entered knowing the type of application, but they are normally 
refined, or tuned, by "bumping" the process in practice by introducing a setpoint change and observing the system response.

In Our case, 
The tuning constants ( Kp, Ki and Kd) were obtained by manual tuning the following way worked out well then twiddle.

 * Increase the Kp until the response is steady oscillation.
 * Increase the D gain until the the oscillations go away (i.e. it's critically damped).
 * Repeat steps 2 and 3 until increasing the D gain does not stop the oscillations.
 * Set P and D to the last stable values.
 * Increase the I gain until it brings you to the setpoint with the number of oscillations desired.
